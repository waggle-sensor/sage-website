"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[490],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var a=t(96540);const i={},s=a.createContext(i);function o(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(s.Provider,{value:n},e.children)}},29550:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"tutorials/edge-apps/testing-an-edge-app","title":"Part 3: Testing an edge app","description":"In the previous part, we took a code snippit and iterated on it until it was ready for the edge. By the end, we had basic camera access and publishing working!","source":"@site/docs/tutorials/edge-apps/3-testing-an-edge-app.md","sourceDirName":"tutorials/edge-apps","slug":"/tutorials/edge-apps/testing-an-edge-app","permalink":"/docs/tutorials/edge-apps/testing-an-edge-app","draft":false,"unlisted":false,"editUrl":"https://github.com/waggle-sensor/sage-website/edit/main/docs/tutorials/edge-apps/3-testing-an-edge-app.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Part 2: Creating an edge app","permalink":"/docs/tutorials/edge-apps/creating-an-edge-app"},"next":{"title":"Part 4: Publishing to ECR","permalink":"/docs/tutorials/edge-apps/publishing-to-ecr"}}');var i=t(74848),s=t(28453);const o={sidebar_position:3},r="Part 3: Testing an edge app",l={},c=[{value:"Accessing development nodes",id:"accessing-development-nodes",level:2},{value:"Creating a repo for our app",id:"creating-a-repo-for-our-app",level:2},{value:"Building our app",id:"building-our-app",level:2},{value:"Running our app",id:"running-our-app",level:2},{value:"Viewing our output",id:"viewing-our-output",level:2},{value:"Next steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"part-3-testing-an-edge-app",children:"Part 3: Testing an edge app"})}),"\n",(0,i.jsxs)(n.p,{children:["In the ",(0,i.jsx)(n.a,{href:"creating-an-edge-app",children:"previous part"}),", we took a code snippit and iterated on it until it was ready for the edge. By the end, we had basic camera access and publishing working!"]}),"\n",(0,i.jsx)(n.p,{children:"Now, we're ready to start testing it on a development node and describing our build steps."}),"\n",(0,i.jsx)(n.h2,{id:"accessing-development-nodes",children:"Accessing development nodes"}),"\n",(0,i.jsx)(n.p,{children:"The first thing we need to do is get access to a development node. Unfortunately, we are still developing the infrastructure to open this up to general users."}),"\n",(0,i.jsxs)(n.p,{children:["For now, please ",(0,i.jsx)(n.a,{href:"/docs/contact-us",children:"contact us"})," to request access to a development node and we'll work with you to setup access."]}),"\n",(0,i.jsx)(n.h2,{id:"creating-a-repo-for-our-app",children:"Creating a repo for our app"}),"\n",(0,i.jsx)(n.p,{children:"Before connecting to our node, let's take a moment to organize our code into a repo we will later use on the node."}),"\n",(0,i.jsxs)(n.p,{children:["Go ahead and create a new Github repo named ",(0,i.jsx)(n.code,{children:"app-tutorial"})," and commit the files from ",(0,i.jsx)(n.a,{href:"creating-an-edge-app",children:"previous part"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"building-our-app",children:"Building our app"}),"\n",(0,i.jsxs)(n.p,{children:["Now that we've setup node access, ssh to the node then clone and cd into your ",(0,i.jsx)(n.code,{children:"app-tutorial"})," repo:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"git clone https://github.com/username/app-tutorial\ncd app-tutorial\n"})}),"\n",(0,i.jsx)(n.p,{children:"The first thing we'll do is build our app on the node:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"sudo pluginctl build .\n"})}),"\n",(0,i.jsx)(n.p,{children:"This may take some time, but once it completes you should see something like:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-txt",children:'Sending build context to Docker daemon  59.39kB\nStep 1/6 : FROM waggle/plugin-base:1.1.1-base\n...\nStep 2/6 : WORKDIR /app\n...\nStep 3/6 : COPY requirements.txt .\n...\nStep 4/6 : RUN pip3 install --no-cache-dir -r requirements.txt\n...\nStep 5/6 : COPY . .\n...\nStep 6/6 : ENTRYPOINT ["python3", "main.py"]\n...\nb38bc0a208d0: Pushed \n1101ffccd70a: Pushed \nlatest: digest: sha256:7bee2a62fbcc9913f1c53bbdab79e973e70947618ffe4db90cae6a8f0ff6c8d7 size: 2407\nSuccessfully built plugin\n\n10.31.81.1:5000/local/app-tutorial\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Once we see ",(0,i.jsx)(n.code,{children:"Successfully built plugin"}),", we can continue to running our app."]}),"\n",(0,i.jsx)(n.h2,{id:"running-our-app",children:"Running our app"}),"\n",(0,i.jsxs)(n.p,{children:["When we successfully built our app, the last line of output was ",(0,i.jsx)(n.code,{children:"10.31.81.1:5000/local/app-tutorial"}),". We will\nnow use this reference to run our app."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"sudo pluginctl run --name app-tutorial 10.31.81.1:5000/local/app-tutorial\n"})}),"\n",(0,i.jsx)(n.p,{children:"When you run this, you'll see that there's a bug in the code:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:'Launched the plugin app-tutorial-1659971085 successfully \nINFO: 2022/08/08 15:04:45 run.go:63: Plugin is in "Pending" state. Waiting...\n\n[ WARN:0@0.032] global /io/opencv/modules/videoio/src/cap_v4l.cpp (902) open VIDEOIO(V4L2:/dev/video0): can\'t open camera by index\nTraceback (most recent call last):\n  File "main.py", line 32, in <module>\n    main()\n  File "main.py", line 15, in main\n    with Camera() as camera:\n  File "/usr/local/lib/python3.8/dist-packages/waggle/data/vision.py", line 107, in __enter__\n    self.capture.__enter__()\n  File "/usr/local/lib/python3.8/dist-packages/waggle/data/vision.py", line 133, in __enter__\n    raise RuntimeError(f"unable to open video capture for device {self.device!r}")\nRuntimeError: unable to open video capture for device 0\n'})}),"\n",(0,i.jsx)(n.p,{children:"This was caused by the fact that most nodes have multiple cameras, so we need to be more specific about which camera to use."}),"\n",(0,i.jsxs)(n.p,{children:["To address this, we'll change the following line in ",(0,i.jsx)(n.code,{children:"main.py"})," from:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"        with Camera() as camera:\n"})}),"\n",(0,i.jsx)(n.p,{children:"to:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'        with Camera("left") as camera:\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.em,{children:["The specific camera name will depend on your specific node. If you are having problems accessing a camera, please ",(0,i.jsx)(n.a,{href:"/docs/contact-us",children:"contact us"})," for more details."]})}),"\n",(0,i.jsx)(n.p,{children:"After rebuilding and running this again, the plugin should run and exit cleanly:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-txt",children:'Launched the plugin app-tutorial-1659971085 successfully \nINFO: 2022/08/08 15:04:45 run.go:63: Plugin is in "Pending" state. Waiting...\n# should exit cleanly with no output\n'})}),"\n",(0,i.jsx)(n.p,{children:"Now that we know this works, please commit and push the change to the repo from your machine."}),"\n",(0,i.jsx)(n.p,{children:"Finally, if you are rebuilding and running code frequently, you can combine the build and run into a single step as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"sudo pluginctl run --name app-tutorial $(sudo pluginctl build .)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"viewing-our-output",children:"Viewing our output"}),"\n",(0,i.jsxs)(n.p,{children:["We'll close this part, by looking at the data we just published. To do this, we'll query the ",(0,i.jsx)(n.a,{href:"/docs/about/architecture#data-repository-dr",children:"Beehive Data Repository"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:'curl -s \'Content-Type: application/json\' https://data.sagecontinuum.org/api/v1/query -d \'\n{\n    "start": "-5m",\n    "filter": {\n        "task": "app-tutorial"\n    }\n}\'\n'})}),"\n",(0,i.jsx)(n.p,{children:"You should see some results like:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{"timestamp":"2022-08-08T15:04:48.820981933Z","name":"color.mean.b","value":133.61671793619792,"meta":{"host":"000048b02d15bdc2.ws-nxcore","job":"Pluginctl","node":"000048b02d15bdc2","plugin":"app-tutorial","task":"app-tutorial","vsn":"W02F"}}\n{"timestamp":"2022-08-08T15:04:48.820981933Z","name":"color.mean.g","value":136.46639404296874,"meta":{"host":"000048b02d15bdc2.ws-nxcore","job":"Pluginctl","node":"000048b02d15bdc2","plugin":"app-tutorial","task":"app-tutorial","vsn":"W02F"}}\n{"timestamp":"2022-08-08T15:04:48.820981933Z","name":"color.mean.r","value":134.48696818033855,"meta":{"host":"000048b02d15bdc2.ws-nxcore","job":"Pluginctl","node":"000048b02d15bdc2","plugin":"app-tutorial","task":"app-tutorial","vsn":"W02F"}}\n{"timestamp":"2022-08-08T15:04:48.820981933Z","name":"upload","value":"https://storage.sagecontinuum.org/api/v1/data/Pluginctl/sage-app-tutorial-app-tutorial/000048b02d15bdc2/1659971088820981933-snapshot.jpg","meta":{"filename":"snapshot.jpg","host":"000048b02d15bdc2.ws-nxcore","job":"Pluginctl","node":"000048b02d15bdc2","plugin":"app-tutorial","task":"app-tutorial","vsn":"W02F"}}\n'})}),"\n",(0,i.jsx)(n.p,{children:"These are exactly the mean color values we computed and published!"}),"\n",(0,i.jsxs)(n.p,{children:["This is intended to be a quick preview of how to access data to help get you started. If you are interested, we cover this topic in much depth ",(0,i.jsx)(n.a,{href:"../accessing-data",children:"here"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,i.jsxs)(n.p,{children:["Now we've been able to build, run and even fix a bug in our code! In ",(0,i.jsx)(n.a,{href:"publishing-to-ecr",children:"part 4"}),", we'll see how to publish a first release of our code to the Edge Code Repository!"]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);